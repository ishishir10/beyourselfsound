if("undefined"==typeof jQuery)throw new Error("trackswitchjs's JavaScript requires jQuery. jQuery must be included before trackswitchjs's JavaScript.");+function(t){var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>=4)throw new Error("trackswitchjs's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(jQuery),function(){function t(t,s){this.element=$(t),this.options=$.extend({},o,s),this.options.mute||this.options.solo||(console.error("Cannot disable both solo and mute, reactivating solo"),this.options.solo=!0),this.options.onlyradiosolo&&(this.options.mute=!1,this.options.radiosolo=!0),this._defaults=o,this._name=i,this.numberOfTracks=0,this.longestDuration=0,this.playing=!1,this.repeat=this.options.repeat,this.startTime,this.position=0,this.timerUpdateUI,this.currentlySeeking=!1,this.seekingElement,this.trackProperties=Array(),this.trackSources=Array(),this.trackGainNode=Array(),this.trackBuffer=Array(),this.activeAudioSources=Array(),e&&(this.gainNodeMaster=e.createGain(),this.gainNodeMaster.gain.value=0,this.gainNodeMaster.connect(e.destination)),this.init()}var e=function(){return"undefined"!=typeof AudioContext?new AudioContext:"undefined"!=typeof webkitAudioContext?new webkitAudioContext:"undefined"!=typeof mozAudioContext?new mozAudioContext:null}(),i=(document.registerElement("ts-track"),document.registerElement("ts-source"),"trackSwitch"),o={mute:!0,solo:!0,globalsolo:!0,repeat:!1,radiosolo:!1,onlyradiosolo:!1,spacebar:!1,tabview:!1};t.prototype.init=function(){var t=this;this.element.addClass("jquery-trackswitch"),0===this.element.find(".main-control").length&&this.element.prepend('<div class="overlay"><span class="activate">Activate</span><p id="overlaytext"></p><p id="overlayinfo"><span class="info">Info</span><span class="text"><strong>trackswitch.js</strong> - open source multitrack audio player<br /><a href="https://github.com/audiolabs/trackswitch.js">https://github.com/audiolabs/trackswitch.js</a></span></p></div><div class="main-control"><ul class="control"><li class="stop button">Stop</li><li class="playpause button">Play</li><li class="title"><img class="jsicon" src="https://static.wixstatic.com/media/2a5dd0_22bf2b34d1f444c8937697a304bdac55~mv2.png"><p class="tname">Drop Elevation</p></li><li class="seekwrap"><div class="seekbar"><div class="seekhead"></div></div></li></ul></div>'),this.element.find(".seekable:not(.seekable-img-wrap > .seekable)").length>0&&this.element.find(".main-control .seekwrap").hide(),this.element.find(".seekable:not(.seekable-img-wrap > .seekable)").each(function(){t.originalImage=this.src,$(this).wrap('<div class="seekable-img-wrap" style="'+$(this).data("style")+'; display: block;"></div>'),$(this).after('<div class="seekwrap" style=" left: '+($(this).data("seekMarginLeft")||0)+"%; right: "+($(this).data("seekMarginRight")||0)+'%;"><div class="seekhead"></div></div>')}),this.element.on("touchstart mousedown",".overlay .activate",$.proxy(this.load,this)),this.element.on("touchstart mousedown",".overlay #overlayinfo .info",$.proxy(function(){this.element.find(".overlay .info").hide(),this.element.find(".overlay .text").show()},this)),this.element.one("loaded",$.proxy(this.loaded,this)),this.element.one("errored",$.proxy(this.errored,this));var i=$('<ul class="track_list"></ul>');if(this.numberOfTracks=this.element.find("ts-track").length,this.numberOfTracks>0){if(this.element.find("ts-track").each(function(e){t.trackProperties[e]={mute:!1,solo:!1,success:!1,error:!1};var o=t.options.tabview?" tabs":"",s=t.options.radiosolo?" radio":"",r=t.options.onlyradiosolo?" solo":"";i.append('<li class="track'+o+r+'" style="'+($(this).attr("style")||"")+'">'+($(this).attr("title")||"Track "+(e+1))+'<ul class="control">'+(t.options.solo?'<li class="solo button'+s+'" title="Solo">Solo</li>':"")+"</ul></li>")}),this.element.append(i),this.options.radiosolo&&(this.trackProperties[0].solo=!0,this.apply_track_properties()),this.updateMainControls(),!e)return this.element.trigger("errored"),this.element.find("#overlaytext").html("Web Audio API is not supported in your browser. Please consider upgrading."),!1}else this.element.trigger("errored")},t.prototype.destroy=function(){this.element.find(".main-control").remove(),this.element.find(".tracks").remove(),this.element.removeData()},t.prototype.sourceFailed=function(t,e,i){void 0!==this.trackSources[t][e+1]?this.prepareRequest(t,e+1):(this.trackProperties[t].error=!0,this.trackStatusChanged())},t.prototype.decodeAudio=function(t,i,o){var s=this,r=t.response;e.decodeAudioData(r,function(t){s.trackGainNode[i]=e.createGain(),s.trackGainNode[i].connect(s.gainNodeMaster),s.trackBuffer[i]=e.createBufferSource(),s.trackBuffer[i].buffer=t,s.trackProperties[i].success=!0,s.trackStatusChanged()},function(t){s.sourceFailed(i,o,"Error Decoding File Type")})},t.prototype.makeRequest=function(t,e){var i=this,o=$(this.trackSources[t][e]).attr("src"),s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?i.decodeAudio(s,t,e):i.sourceFailed(t,e,"404 - File Not Found"))},s.send()},t.prototype.prepareRequest=function(t,e){void 0!==this.trackSources[t][e]?this.makeRequest(t,e):this.sourceFailed(t,e,"No Source Found")},t.prototype.load=function(t){if(!this.valid_click(t))return!0;t.preventDefault();var e=this;if(this.element.find(".overlay span.activate").addClass("fa-spin loading"),this.numberOfTracks>0){var i=document.createElement("audio"),o={".aac":"audio/aac;",".aif":"audio/aiff;",".aiff":"audio/aiff;",".au":"audio/basic;",".mp1":"audio/mpeg;",".mp2":"audio/mpeg;",".mp3":"audio/mpeg;",".mpg":"audio/mpeg;",".mpeg":"audio/mpeg;",".m4a":"audio/mp4;",".mp4":"audio/mp4;",".oga":"audio/ogg;",".ogg":"audio/ogg;",".wav":"audio/wav;",".webm":"audio/webm;"};this.element.find("ts-track").each(function(t){e.trackSources[t]=$(this).find("ts-source");for(var s=0;s<e.trackSources[t].length;s++){if(void 0!==$(e.trackSources[t][s]).attr("type"))var r=$(e.trackSources[t][s]).attr("type")+";";else{var a=$(e.trackSources[t][s]).attr("src").substring($(e.trackSources[t][s]).attr("src").lastIndexOf("."));console.log(a);var r=void 0!==o[a]?o[a]:"audio/"+a.substr(1)+";"}i.canPlayType&&i.canPlayType(r).replace(/no/,"")||e.trackSources[t].splice(s,1)}})}for(var s=0;s<this.trackSources.length;s++)this.prepareRequest(s,0);return t.stopPropagation(),!1},t.prototype.findLongest=function(){for(var t=0;t<this.numberOfTracks;t++){var e=this.trackBuffer[t].buffer.duration;e>this.longestDuration&&(this.longestDuration=e)}this.element.trigger("loaded")},t.prototype.trackStatusChanged=function(){var t=0,e=0;this.trackProperties.forEach(function(i){t+=i.success||i.error?1:0,e+=i.error?1:0}),t===this.numberOfTracks&&(0===e?this.findLongest():(this.element.trigger("errored"),this.element.find("#overlaytext").html("One or more audio files failed to load.")))},t.prototype.loaded=function(){this.element.find(".overlay").removeClass("loading"),this.element.find(".overlay").hide().remove(),$(this.element).find(".timing .time").html("00:00:00:000"),$(this.element).find(".timing .length").html(this.secondsToHHMMSSmmm(this.longestDuration)),this.apply_track_properties(),this.bindEvents()},t.prototype.errored=function(){this.element.find(".overlay span").removeClass("fa-spin loading"),this.element.addClass("error");var t=this;this.trackProperties.forEach(function(e,i){e.error&&$(t.element).find(".track_list > li:nth-child("+(i+1)+")").addClass("error")}),this.unbindEvents()},t.prototype.unbindEvents=function(){this.element.off("touchstart mousedown",".overlay span"),this.element.off("loaded"),this.element.off("touchstart mousedown",".playpause"),this.element.off("touchstart mousedown",".stop"),this.element.off("touchstart mousedown",".repeat"),this.element.off("mousedown touchstart",".seekwrap"),this.element.off("mousemove touchmove"),this.element.off("mouseup touchend"),this.element.off("touchstart mousedown",".mute"),this.element.off("touchstart mousedown",".solo"),this.options.spacebar&&$(window).unbind("keypress")},t.prototype.bindEvents=function(){if(this.element.on("touchstart mousedown",".playpause",$.proxy(this.event_playpause,this)),this.element.on("touchstart mousedown",".stop",$.proxy(this.event_stop,this)),this.element.on("touchstart mousedown",".repeat",$.proxy(this.event_repeat,this)),this.element.on("mousedown touchstart",".seekwrap",$.proxy(this.event_seekStart,this)),this.element.on("mousemove touchmove",$.proxy(this.event_seekMove,this)),this.element.on("mouseup touchend",$.proxy(this.event_seekEnd,this)),this.element.on("touchstart mousedown",".mute",$.proxy(this.event_mute,this)),this.element.on("touchstart mousedown",".solo",$.proxy(this.event_solo,this)),this.options.spacebar){var t=this;$(window).unbind("keypress"),$(window).keypress(function(e){32===e.which&&t.event_playpause(e)})}},t.prototype.valid_click=function(t){return"touchstart"===t.type||"mousedown"===t.type&&1===t.which},t.prototype.secondsToHHMMSSmmm=function(t){var e=parseInt(t/3600)%24;e=10>e?"0"+e:e;var i=parseInt(t/60)%60;i=10>i?"0"+i:i;var o=t%60;o=o.toString().split(".")[0],o=10>o?"0"+o:o;var s=Math.round(t%1*1e3);return s=10>s?"00"+s:100>s?"0"+s:s,e+":"+i+":"+o+":"+s},t.prototype.updateMainControls=function(){this.element.find(".playpause").toggleClass("checked",this.playing),this.element.find(".repeat").toggleClass("checked",this.repeat);var t=this.position/this.longestDuration*100;this.element.find(".seekhead").each(function(){$(this).css({left:t+"%"})}),0!==this.longestDuration&&$(this.element).find(".timing .time").html(this.secondsToHHMMSSmmm(this.position))},t.prototype.monitorPosition=function(t){t.position=t.playing&&!t.currentlySeeking?e.currentTime-t.startTime:t.position,t.position>=t.longestDuration&&!t.currentlySeeking&&(t.position=0,t.stopAudio(),t.repeat?t.startAudio(t.position):t.playing=!1),t.updateMainControls()},t.prototype.stopAudio=function(){var t=e.currentTime;this.gainNodeMaster.gain.cancelScheduledValues(t),this.gainNodeMaster.gain.setValueAtTime(1,t),this.gainNodeMaster.gain.linearRampToValueAtTime(0,t+.03);for(var i=0;i<this.numberOfTracks;i++)this.activeAudioSources[i].stop(t+.03);clearInterval(this.timerMonitorPosition)},t.prototype.startAudio=function(t,i){var o=this,s=e.currentTime,r=downwardRamp=.03;this.position=void 0!==t?t:this.position||0;for(var a=0;a<this.numberOfTracks;a++)this.activeAudioSources[a]=null,this.activeAudioSources[a]=e.createBufferSource(),this.activeAudioSources[a].buffer=this.trackBuffer[a].buffer,this.activeAudioSources[a].connect(this.trackGainNode[a]),void 0!==i?(this.gainNodeMaster.gain.setValueAtTime(0,s+downwardRamp),this.gainNodeMaster.gain.linearRampToValueAtTime(1,s+downwardRamp+r),this.activeAudioSources[a].start(s+downwardRamp,this.position+downwardRamp,r+i),this.gainNodeMaster.gain.setValueAtTime(1,s+downwardRamp+r),this.gainNodeMaster.gain.linearRampToValueAtTime(0,s+downwardRamp+r+i)):(this.gainNodeMaster.gain.cancelScheduledValues(s),this.gainNodeMaster.gain.setValueAtTime(0,s),this.gainNodeMaster.gain.linearRampToValueAtTime(1,s+r),this.activeAudioSources[a].start(s,this.position));this.startTime=s-(this.position||0),this.timerMonitorPosition=setInterval(function(){o.monitorPosition(o)},16)},t.prototype.pause=function(){!0===this.playing&&(this.stopAudio(),this.position=e.currentTime-this.startTime,this.playing=!1,this.updateMainControls())},t.prototype.other_instances=function(){return $(".jquery-trackswitch").not(this.element)},t.prototype.pause_others=function(){this.options.globalsolo&&this.other_instances().each(function(){$(this).data("plugin_"+i).pause()})},t.prototype.event_playpause=function(t){return!this.valid_click(t)&&32!==t.which||(t.preventDefault(),this.playing?this.pause():(this.startAudio(),this.pause_others(),this.playing=!0,this.updateMainControls()),t.stopPropagation(),!1)},t.prototype.event_stop=function(t){return this.valid_click(t)?(t.preventDefault(),this.playing&&this.stopAudio(),this.position=0,this.playing=!1,this.updateMainControls(),t.stopPropagation(),!1):!0},t.prototype.event_repeat=function(t){return!this.valid_click(t)||(t.preventDefault(),this.repeat=!this.repeat,this.updateMainControls(),t.stopPropagation(),!1)},t.prototype.seek=function(t){if(t.type.indexOf("mouse")>=0)var e=t.pageX-$(this.seekingElement).offset().left;else var e=t.originalEvent.touches[0].pageX-$(this.seekingElement).offset().left;var i=$(this.seekingElement).width();i=1>i?1:i;var o=0>e?0:e>i?i:e,s=o/i*100,r=this.longestDuration*(s/100);e>=0&&i>=e&&this.playing?(this.stopAudio(),this.startAudio(r,.03)):this.position=r,this.updateMainControls()},t.prototype.event_seekStart=function(t){return!this.valid_click(t)||(t.preventDefault(),this.seekingElement=$(t.target).closest(".seekwrap"),this.seek(t),this.currentlySeeking=!0,t.stopPropagation(),!1)},t.prototype.event_seekMove=function(t){return this.currentlySeeking?(t.preventDefault(),this.seek(t),!1):void t.stopPropagation()},t.prototype.event_seekEnd=function(t){return t.preventDefault(),this.currentlySeeking&&this.playing&&this.startAudio(),this.currentlySeeking=!1,t.stopPropagation(),!1},t.prototype._index_from_target=function(t){return $(t).closest(".track").prevAll().length},t.prototype.event_solo=function(t){if(!this.valid_click(t))return!0;var e=this._index_from_target(t.target),i=this,o=this.trackProperties[e].solo;(t.shiftKey||this.options.radiosolo)&&$.each(this.trackProperties,function(t,e){i.trackProperties[t].solo=!1}),(this.options.radiosolo||t.shiftKey)&&o?this.trackProperties[e].solo=!0:this.trackProperties[e].solo=!o,this.apply_track_properties()},t.prototype.event_mute=function(t){if(!this.valid_click(t))return!0;t.preventDefault();var e=this._index_from_target(t.target);return this.trackProperties[e].mute=!this.trackProperties[e].mute,this.apply_track_properties(),t.stopPropagation(),!1},t.prototype.switch_image=function(){var t,e=this,i=0;$.each(this.trackProperties,function(o,s){!0===e.trackProperties[o].solo&&(i++,t=e.element.find("ts-track")[o].dataset.img)}),(1!==i||void 0===t||t.length<1)&&(t=this.originalImage),this.element.find(".seekable").attr("src",t)},t.prototype.apply_track_properties=function(){var t=this,e=!1;$.each(this.trackProperties,function(i,o){e=e||t.trackProperties[i].solo}),$.each(this.trackProperties,function(i,o){var s=t.element.find(".track_list li.track:nth-child("+(i+1)+")");t.trackProperties[i].mute?s.find(".mute").addClass("checked"):s.find(".mute").removeClass("checked"),t.trackProperties[i].solo?s.find(".solo").addClass("checked"):s.find(".solo").removeClass("checked"),t.trackGainNode.length>0&&(t.trackGainNode[i].gain.value=1,t.trackProperties[i].mute?t.trackGainNode[i].gain.value=0:t.trackGainNode[i].gain.value=1,e&&(t.trackProperties[i].solo?t.trackGainNode[i].gain.value=1:t.trackGainNode[i].gain.value=0))}),this.switch_image(),this.deselect()},t.prototype.deselect=function(t){var e="getSelection"in window?window.getSelection():"selection"in document?document.selection:null;"removeAllRanges"in e?e.removeAllRanges():"empty"in e&&e.empty()},$.fn[i]=function(e){return this.each(function(){$(this).data("plugin_"+i)||$(this).data("plugin_"+i,new t(this,e))})}}();